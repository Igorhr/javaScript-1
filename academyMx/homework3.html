<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>homework</title>
    <script src="common.js"></script>
  </head>
  <body>
    <script>
      var csvStringNewLineFn = str => str.split('\n');
      //   console.log(csvStringNewLineFn(csvString));
      var csvStringLineToColumnArray = str => str.map(line => line.split(','));
      //   console.log(csvStringLineToColumnArray(csvStringNewLineFn(csvString)));
      var csvStringToObject = strLine => {
        return strLine.map(line => {
          var col = line.split(',');
          return {
            age: col[0],
            firstName: col[1],
            lastName: col[2],
            skill: col[3],
            gender: col[4],
            sallary: col[5]
          };
        });
      };
      //   console.table(csvStringToObject(csvStringNewLineFn(csvString)));
      var dataObj = csvStringToObject(csvStringNewLineFn(csvString));
      // console.table(dataObj)

      var averageSalary = (gender, skill, obj) => {
        var sorted = obj.filter(function(developer) {
          var genderCase = gender === 'all' || developer.gender === gender;
          var skillCase = skill === 'all' || developer.skill === skill;
          return genderCase && skillCase;
        });

        var reduceSalary = sorted.reduce(function(acc, current) {
          acc += current.sallary * 1;
          return acc;
        }, 0);

        var result = (reduceSalary / sorted.length).toFixed(2);
        return console.log(`${sorted.length} - ${gender} - ${skill} ==> ${result}`);
      };
      console.log('devs gender skill averageSalary');
      averageSalary('all', 'all', dataObj);
      averageSalary('male', 'all', dataObj);
      averageSalary('female', 'all', dataObj);
      averageSalary('all', 'frontend', dataObj);
      averageSalary('all', 'backend', dataObj);
      averageSalary('all', 'fullstack', dataObj);
      averageSalary('male', 'frontend', dataObj);
      averageSalary('male', 'backend', dataObj);
      averageSalary('male', 'fullstack', dataObj);
      averageSalary('female', 'frontend', dataObj);
      averageSalary('female', 'backend', dataObj);
      averageSalary('female', 'fullstack', dataObj);

      var averageAge = (gender, skill, obj) => {
        var today = new Date().getFullYear();
        var sorted = obj.filter(developer => 
        (gender === 'all' || developer.gender === gender) &&
        (killCase = skill === 'all' || developer.skill === skill));

        var ageReduce = sorted.reduce((acc, current) => acc += today - current.age*1, 0);

        var howMany = sorted.length;
        var averageAgeResult = (ageReduce / howMany).toFixed(2);
        return console.table(`${howMany} ${gender}  ${skill} ${averageAgeResult}`);
      };
      console.log('NumDevs Gender Skill AvaerageAge');
      averageAge('all', 'all', dataObj);
      averageAge('male', 'all', dataObj);
      averageAge('female', 'all', dataObj);
      averageAge('all', 'frontend', dataObj);
      averageAge('all', 'backend', dataObj);
      averageAge('all', 'fullstack', dataObj);
      averageAge('male', 'frontend', dataObj);
      averageAge('male', 'backend', dataObj);
      averageAge('male', 'fullstack', dataObj);
      averageAge('female', 'frontend', dataObj);
      averageAge('female', 'backend', dataObj);
      averageAge('female', 'fullstack', dataObj);

    </script>
  </body>
</html>
